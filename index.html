<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AReA — Aesthetic Responsiveness Assessment (interactive)</title>
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--accent:#334155}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:0;background:var(--bg);color:#0f172a}
    .wrap{max-width:920px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;gap:16px}
    h1{margin:0;font-size:20px}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,0.06);margin-top:14px}
    label{display:block;margin-bottom:6px;font-weight:600}
    .grid{display:grid;grid-template-columns:1fr 280px;gap:16px}
    .item-list{max-height:520px;overflow:auto;padding:8px;border:1px dashed #e6e9ef;border-radius:8px;background:#fbfcff}
    .item{display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px}
    .item + .item{border-top:1px solid #eef2f7}
    .qtext{flex:1}
    .controls{display:flex;gap:6px;align-items:center}
    button{background:var(--accent);color:white;border:0;padding:8px 10px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;color:var(--accent);border:1px solid #e2e8f0}
    button[type=button]{cursor:pointer}
    .small{font-size:13px;color:#475569}
    .score-box{display:flex;flex-direction:column;gap:8px}
    .result{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:#fbfcff;border:1px solid #eef2f7}
    footer{margin-top:18px;font-size:13px;color:#475569}
    textarea{width:100%;height:120px;border-radius:8px;padding:10px;border:1px solid #e6e9ef}
    select,input[type=number]{padding:8px;border-radius:8px;border:1px solid #e6e9ef}
    .submap{font-size:13px;color:#334155}
    .help{font-size:13px;color:#6b7280}
    .bad{color:#b91c1c}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>The Aesthetic Responsiveness Assessment — interactive builder & scorer</h1>
    </header>

    <div class="card">
      <div class="small">About</div>
      <p style="margin:6px 0 12px" class="help">This single-file tool lets you build a 14-item (or custom-length) AReA questionnaire, collect responses on a 1–5 Likert scale, and compute total &amp; subscale scores. Paste Korean items (one per line) or use the demo.</p>

      <div style="display:flex;gap:10px;align-items:center;margin-bottom:10px">
        <button id="addPlaceholder" type="button">Insert example items (demo)</button>
        <button id="clearItems" class="ghost" type="button">Clear items</button>
        <button id="loadOfficial" class="ghost" type="button">Open source page</button>
        <div style="margin-left:auto" class="small">Scale: <strong>1 (전혀 그렇지 않다) — 5 (매우 그렇다)</strong></div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 360px;gap:12px">
        <div>
          <label for="itemsIn">Paste items (one per line) or edit:</label>
          <textarea id="itemsIn" placeholder="1. ...\n2. ..."></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="applyItems" type="button">Apply items</button>
            <button id="importCSV" class="ghost" type="button">Import CSV (items only)</button>
            <div class="help" style="margin-left:auto">You can also edit items directly in the left column after applying.</div>
          </div>
        </div>

        <div>
          <label>Subscale mapping (assign each item to a subscale)</label>
          <div class="card submap" id="subscalePanel">
            <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
              <select id="subscaleDefault">
                <option value="AA">Aesthetic Appreciation (AA)</option>
                <option value="IAE">Intense Aesthetic Experience (IAE)</option>
                <option value="CB">Creative Behavior (CB)</option>
                <option value="NONE">None / total-only</option>
              </select>
              <button id="assignDefault" class="ghost" type="button">Assign selected to all (quick)</button>
            </div>
            <div class="help">After you apply items, each item will show a dropdown so you can set which subscale it belongs to. You can change assignments per-item.</div>
          </div>
        </div>
      </div>

    </div>

    <div class="grid" style="margin-top:12px">
      <div class="card">
        <label>Question items</label>
        <div class="item-list" id="itemList" aria-live="polite"></div>

        <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
          <button id="startSurvey" type="button">Open survey (simulate / take test)</button>
          <button id="exportJSON" class="ghost" type="button">Export items JSON</button>
          <button id="exportCSV" class="ghost" type="button">Export items CSV</button>
          <div style="margin-left:auto" class="small">Items: <span id="itemCount">0</span></div>
        </div>
      </div>

      <div class="card score-box">
        <label>Scoring &amp; results</label>
        <div class="small">Response scale</div>
        <div style="display:flex;gap:8px;margin-bottom:8px;align-items:center">
          <label style="margin-bottom:0">Min</label>
          <input type="number" id="minScale" value="1" style="width:64px" />
          <label style="margin-bottom:0">Max</label>
          <input type="number" id="maxScale" value="5" style="width:64px" />
          <div class="help" style="margin-left:auto">Supports reverse-coded items (flip per-item).</div>
        </div>

        <div id="resultsArea">
          <div class="result"><div>각 항목 점수</div><div id="itemScores">—</div></div>
          <div class="result"><div>총합 (sum)</div><div id="totalScore">—</div></div>
          <div class="result"><div>전체 평균 (mean)</div><div id="meanScore">—</div></div>
          <div class="result"><div>AA (Aesthetic Appreciation) — 평균</div><div id="aaScore">—</div></div>
          <div class="result"><div>IAE (Intense Aesthetic Experience) — 평균</div><div id="iaeScore">—</div></div>
          <div class="result"><div>CB (Creative Behavior) — 평균</div><div id="cbScore">—</div></div>

          <div style="margin-top:10px;display:flex;gap:8px">
            <button id="simulateRandom" type="button">Simulate random responses</button>
            <button id="exportResponses" class="ghost" type="button">Export responses CSV</button>
            <button id="clearResponses" class="ghost" type="button">Clear responses</button>
          </div>

        </div>
      </div>
    </div>

    <footer>
      <div>Notes: The official AReA items and scoring are available from the instrument authors. This tool is generic: paste the official 14 items into the editor (or use demo) and map subscales.</div>
    </footer>
  </div>

  <!-- Survey modal (simple) -->
  <div id="surveyModal" style="display:none;position:fixed;inset:0;background:rgba(2,6,23,0.6);align-items:center;justify-content:center;padding:20px">
    <div style="max-width:820px;width:100%;background:white;border-radius:12px;padding:18px;max-height:90vh;overflow:auto">
      <h3>Take the questionnaire</h3>
      <form id="surveyForm"></form>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="submitSurvey" type="button">Submit</button>
        <button id="closeSurvey" class="ghost" type="button">Close</button>
      </div>
    </div>
  </div>

  <script>
    // Cleaned and debugged client-side AReA builder & scorer
    const itemsIn = document.getElementById('itemsIn');
    const applyBtn = document.getElementById('applyItems');
    const itemList = document.getElementById('itemList');
    const itemCount = document.getElementById('itemCount');
    const startSurvey = document.getElementById('startSurvey');
    const surveyModal = document.getElementById('surveyModal');
    const surveyForm = document.getElementById('surveyForm');
    const submitSurvey = document.getElementById('submitSurvey');
    const closeSurvey = document.getElementById('closeSurvey');
    const minScaleIn = document.getElementById('minScale');
    const maxScaleIn = document.getElementById('maxScale');

    const totalScoreEl = document.getElementById('totalScore');
    const meanScoreEl = document.getElementById('meanScore');
    const aaScoreEl = document.getElementById('aaScore');
    const iaeScoreEl = document.getElementById('iaeScore');
    const cbScoreEl = document.getElementById('cbScore');
    const itemScoresEl = document.getElementById('itemScores');

    const exportJSON = document.getElementById('exportJSON');
    const exportCSV = document.getElementById('exportCSV');
    const exportResponses = document.getElementById('exportResponses');
    const simulateRandom = document.getElementById('simulateRandom');
    const clearItemsBtn = document.getElementById('clearItems');
    const addPlaceholder = document.getElementById('addPlaceholder');
    const loadOfficial = document.getElementById('loadOfficial');
    const assignDefault = document.getElementById('assignDefault');
    const subscaleDefault = document.getElementById('subscaleDefault');

    let items = []; // {id, text, subscale, reverse}
    let lastResponses = null;

    function renderItems(){
      itemList.innerHTML = '';
      items.forEach((it,i)=>{
        const row = document.createElement('div'); row.className='item';
        const q = document.createElement('div'); q.className='qtext';
        const editable = document.createElement('textarea'); editable.value = it.text; editable.style.height='44px'; editable.style.border='0'; editable.style.background='transparent';
        editable.addEventListener('input', ()=>{it.text = editable.value});
        q.appendChild(editable);
        const controls = document.createElement('div'); controls.className='controls';
        const sel = document.createElement('select');
        ['AA','IAE','CB','NONE'].forEach(s=>{const o=document.createElement('option');o.value=s;o.textContent=s; if(it.subscale===s) o.selected=true; sel.appendChild(o)});
        sel.addEventListener('change', ()=>{it.subscale = sel.value});
        const rev = document.createElement('label'); rev.className='small'; rev.style.display='flex'; rev.style.alignItems='center';
        const chk = document.createElement('input'); chk.type='checkbox'; chk.checked = !!it.reverse; chk.addEventListener('change', ()=>{it.reverse=chk.checked});
        rev.appendChild(chk); rev.appendChild(document.createTextNode(' reverse'));
        const up = document.createElement('button'); up.type='button'; up.textContent='↑'; up.title='Move up'; up.style.padding='6px'; up.addEventListener('click', ()=>{if(i>0){items.splice(i,1); items.splice(i-1,0,it); renderItems();}})
        const down = document.createElement('button'); down.type='button'; down.textContent='↓'; down.title='Move down'; down.style.padding='6px'; down.addEventListener('click', ()=>{if(i<items.length-1){items.splice(i,1); items.splice(i+1,0,it); renderItems();}})
        const del = document.createElement('button'); del.type='button'; del.textContent='✕'; del.title='Remove'; del.style.padding='6px'; del.addEventListener('click', ()=>{items.splice(i,1); renderItems();})
        controls.appendChild(sel); controls.appendChild(rev); controls.appendChild(up); controls.appendChild(down); controls.appendChild(del);
        row.appendChild(q); row.appendChild(controls); itemList.appendChild(row);
      })
      itemCount.textContent = items.length;
    }

    applyBtn.addEventListener('click', ()=>{
      const raw = itemsIn.value.trim();
      if(!raw){alert('Paste one item per line (or use example items).');return}
      const lines = raw.split('\n').map(s=>s.trim()).filter(Boolean);
      items = lines.map((t,idx)=>({id:idx+1,text:t,subscale:'NONE',reverse:false}));
      renderItems();
    });

    addPlaceholder.addEventListener('click', ()=>{
      const demo = [
        '나는 박물관을 방문하거나 음악/무용 공연을 보러 간다.',
        '나는 예술 작품을 볼 때 아름다움을 알아차린다.',
        '나는 음악에 의해 감정적으로 크게 움직인다.',
        '예술 작품을 볼 때, 나는 그 조화로움에 감탄한다.',
        '나는 조각, 회화, 드로잉, 영화 연출 또는 디자인 작업을 한다.',
        '나는 예술 작품을 볼 때 긍정적인 에너지나 활력을 느낀다.',
        '나는 시나 소설을 쓴다.',
        '나는 예술 작품을 볼 때 심장이 빨리 뛰거나, 땀이 나거나, 어지럽거나, 그 밖의 신체적 반응을 경험한다.',
        '나는 건축물의 시각적 디자인을 감상한다.',
        '나는 현재(또는 과거에) 미술, 창작 글쓰기, 또는 미학 관련 수업을 듣고 있다(또는 들은 적이 있다).',
        '나는 예술 작품을 볼 때 경외감, 두려움, 혹은 압도되는 감정을 느낀다.',
        '나는 예술 작품을 감상할 때 우주/자연/존재/신성과 하나가 된 듯한 일체감이나 연결감을 느낀다.',
        '나는 예술 작품을 볼 때 깊이 감동받는다.',
        '나는 예술 작품을 볼 때 기쁨, 평온함, 또는 그 밖의 긍정적 감정을 경험한다.'
      ];
      items = demo.map((t,i)=>({id:i+1,text:t,subscale:['AA','IAE','CB','AA','IAE','CB','AA','IAE','CB','AA','IAE','CB','AA','IAE'][i]||'NONE',reverse:false}));
      renderItems();
      itemsIn.value = items.map(it=>it.text).join('\n');
    });

    clearItemsBtn.addEventListener('click', ()=>{if(confirm('Clear all items?')){items=[];renderItems();itemsIn.value=''}})

    loadOfficial.addEventListener('click', ()=>{
      window.open('https://www.edvessel.com/area','_blank');
    });

    assignDefault.addEventListener('click', ()=>{
      const val = subscaleDefault.value;
      items.forEach(it=>it.subscale=val);
      renderItems();
    });

    startSurvey.addEventListener('click', ()=>{
      if(items.length===0){alert('No items defined. Paste items in the editor and click Apply.');return}
      surveyForm.innerHTML='';
      const min = Number(minScaleIn.value) || 1;
      const max = Number(maxScaleIn.value) || 5;
      items.forEach((it,i)=>{
        const div = document.createElement('div'); div.style.marginBottom='10px';
        const lab = document.createElement('label'); lab.textContent = (i+1)+'. '+it.text; lab.style.display='block'; lab.style.fontWeight='600';
        const row = document.createElement('div'); row.style.display='flex'; row.style.gap='6px'; row.style.marginTop='6px';
        for(let v=min; v<=max; v++){
          const r = document.createElement('label'); r.style.display='inline-flex'; r.style.alignItems='center'; r.style.gap='6px';
          const inp = document.createElement('input'); inp.type='radio'; inp.name='q'+i; inp.value=v; inp.required = true; r.appendChild(inp); r.appendChild(document.createTextNode(v)); row.appendChild(r);
        }
        div.appendChild(lab); div.appendChild(row); surveyForm.appendChild(div);
      });
      surveyModal.style.display='flex'; window.scrollTo(0,0);
    });

    closeSurvey.addEventListener('click', ()=>{surveyModal.style.display='none'});

    submitSurvey.addEventListener('click', ()=>{
      // collect responses from the generated form
      const formData = new FormData(surveyForm);
      const min = Number(minScaleIn.value) || 1;
      const max = Number(maxScaleIn.value) || 5;
      const responses = [];
      for(let i=0;i<items.length;i++){
        const val = formData.get('q'+i);
        if(!val){alert('Please answer all items before submitting.');return}
        responses.push(Number(val));
      }
      lastResponses = responses;
      computeScores(responses, items, min, max);
      surveyModal.style.display='none';
    });

    function computeScores(resp, itemsDef, min, max){
      // adjusted values take reverse-coded items into account
      const adjusted = resp.map((r,i)=>{
        const it = itemsDef[i] || {};
        return it.reverse ? (max + min) - r : r;
      });

      // per-item display (show adjusted values)
      itemScoresEl.textContent = adjusted.join(', ');

      // total sum & overall mean
      const sum = adjusted.reduce((a,b)=>a+b,0);
      const overallMean = (sum / adjusted.length) || 0;
      totalScoreEl.textContent = sum;
      meanScoreEl.textContent = overallMean.toFixed(2) + ' (n=' + adjusted.length + ')';

      // subscale means
      const groups = {AA:[], IAE:[], CB:[]};
      itemsDef.forEach((it,i)=>{ if(groups[it.subscale]) groups[it.subscale].push(adjusted[i]); });

      aaScoreEl.textContent = groups.AA.length ? (groups.AA.reduce((a,b)=>a+b,0)/groups.AA.length).toFixed(2) : '—';
      iaeScoreEl.textContent = groups.IAE.length ? (groups.IAE.reduce((a,b)=>a+b,0)/groups.IAE.length).toFixed(2) : '—';
      cbScoreEl.textContent = groups.CB.length ? (groups.CB.reduce((a,b)=>a+b,0)/groups.CB.length).toFixed(2) : '—';
    }

    simulateRandom.addEventListener('click', ()=>{
      if(items.length===0){alert('No items to simulate.');return}
      const min = Number(minScaleIn.value) || 1; const max = Number(maxScaleIn.value) || 5;
      const resp = items.map(()=> Math.floor(Math.random()*(max-min+1))+min );
      lastResponses = resp;
      computeScores(resp,items,min,max);
      alert('Random responses simulated. Results shown on the right.');
    });

    exportJSON.addEventListener('click', ()=>{
      const data = {items, scale:{min:Number(minScaleIn.value)||1, max:Number(maxScaleIn.value)||5}};
      const blob = new Blob([JSON.stringify(data, null, 2)],{type:'application/json'});
      const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='AReA_items.json'; a.click();
    });

    exportCSV.addEventListener('click', ()=>{
      if(items.length===0){alert('No items to export');return}
      const rows = [['id','text','subscale','reverse']];
      items.forEach(it=>rows.push([it.id, '"'+it.text.replace(/"/g,'""')+'"', it.subscale, it.reverse?1:0]));
      const csv = rows.map(r=>r.join(',')).join('\n'); const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='AReA_items.csv'; a.click();
    });

    exportResponses.addEventListener('click', ()=>{
      if(!lastResponses){alert('No responses available. Take the test or simulate first.');return}
      const rows=[['item_id','item_text','response']];
      items.forEach((it,i)=>rows.push([it.id,'"'+it.text.replace(/"/g,'""')+'"', lastResponses[i]]));
      const csv = rows.map(r=>r.join(',')).join('\n'); const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='AReA_responses.csv'; a.click();
    });

    // initial empty render
    renderItems();
  </script>
</body>
</html>
